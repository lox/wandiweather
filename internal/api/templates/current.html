<header>
    <div class="location">Wandiligong</div>
    <div class="time">{{.LastUpdated.Format "Mon 3:04 PM"}}</div>
</header>

<!-- NOW: Current conditions -->
<div class="hero">
    {{if gt .ValleyTemp 0.0}}
    <div class="temp-now">{{printf "%.0f" .ValleyTemp}}<span class="unit">Â°</span></div>
    {{if .Primary}}
    <div class="conditions-inline">
        {{if .Primary.Humidity.Valid}}<span>{{.Primary.Humidity.Int64}}% humidity</span>{{end}}
        {{if .Primary.WindSpeed.Valid}}<span>ğŸ’¨ {{printf "%.0f" .Primary.WindSpeed.Float64}} km/h</span>{{end}}
        {{if .Primary.UV.Valid}}{{if gt .Primary.UV.Float64 0.0}}<span>â˜€ï¸ UV {{printf "%.0f" .Primary.UV.Float64}}</span>{{end}}{{end}}
    </div>
    {{end}}
    {{else}}
    <div class="temp-now">â€”<span class="unit">Â°</span></div>
    {{end}}
</div>

<!-- TODAY: Forecast -->
{{if .TodayForecast}}
<div class="today-forecast">
    <div class="forecast-header">Today's Forecast</div>
    <div class="forecast-narrative">{{.TodayForecast.Narrative}}</div>
    <div class="forecast-range">
        <div class="range-item">
            <span class="range-value low">{{printf "%.0f" .TodayForecast.TempMin}}Â°</span>
            <span class="range-label">Low</span>
        </div>
        <div class="range-item">
            <span class="range-value high">{{printf "%.0f" .TodayForecast.TempMax}}Â°</span>
            <span class="range-label">High</span>
        </div>
        {{if .TodayForecast.HasPrecip}}
        <div class="range-item">
            <span class="range-value rain">{{.TodayForecast.PrecipChance}}%</span>
            <span class="range-label">Rain</span>
        </div>
        {{end}}
    </div>
    {{if .TodayStats}}
    <div class="observed-progress">
        So far: {{printf "%.0f" .TodayStats.MinTemp}}Â° â€“ {{printf "%.0f" .TodayStats.MaxTemp}}Â°
        {{if .TodayStats.HasRain}} Â· {{printf "%.1f" .TodayStats.RainTotal}}mm rain{{end}}
    </div>
    {{end}}
</div>
{{end}}

{{if .Inversion}}
{{if .Inversion.Active}}
<div class="inversion active">
    <div class="inversion-title">âš ï¸ Inversion Active</div>
    <div class="inversion-detail">
        Valley {{printf "%.1f" .Inversion.ValleyAvg}}Â° Â· Upper {{printf "%.1f" .Inversion.UpperAvg}}Â° 
        ({{printf "%+.1f" .Inversion.Strength}}Â° anomaly)
    </div>
</div>
{{end}}
{{end}}

<div class="forecast-section" hx-get="/partials/forecast" hx-trigger="load, every 3600s" hx-swap="innerHTML"></div>

<div class="stations-toggle">
    <button onclick="toggleStations()">Show all stations</button>
</div>

<div id="stations-grid" class="stations-grid">
    <div class="stations-table">
        <div class="station-header">
            <span class="station-col-name">Station</span>
            <span class="station-col-temp">Temp</span>
            <span class="station-col-elev">Elev</span>
            <span class="station-col-coords">Location</span>
        </div>
        {{range .AllStations}}
        <div class="station-row{{if .Station.IsPrimary}} primary{{end}}">
            <span class="station-col-name">
                <a href="https://www.wunderground.com/dashboard/pws/{{.Station.StationID}}" target="_blank" rel="noopener">{{.Station.StationID}}</a>
                <span class="station-label">{{.Station.Name}}</span>
            </span>
            <span class="station-col-temp">{{if .Obs}}{{if .Obs.Temp.Valid}}{{printf "%.1f" .Obs.Temp.Float64}}Â°{{else}}â€”{{end}}{{else}}â€”{{end}}</span>
            <span class="station-col-elev">{{printf "%.0f" .Station.Elevation}}m</span>
            <span class="station-col-coords">
                <a href="https://www.google.com/maps?q={{.Station.Latitude}},{{.Station.Longitude}}" target="_blank" rel="noopener">{{printf "%.3f" .Station.Latitude}}, {{printf "%.3f" .Station.Longitude}}</a>
            </span>
        </div>
        {{end}}
    </div>
</div>

<div class="updated">
    Updated {{.LastUpdated.Format "3:04:05 PM"}} Â· <a href="/accuracy" style="color: #4fc3f7;">Forecast accuracy</a>
</div>
